#!/bin/sh

logic(){
   W=$(bspc query -N -n .local.tiled | wc -l)
   [ "$W" -le 1 ] && W=1
   G=$(((GN-W)*GS)); $((G-=G0))
   [ "$G" -le "$G0" ] && G="$G0"
   P=$(((PN-W)*PS*10)); [ "$P" -le 1 ] && P=0
}

exec_(){
   bspc config -d focused window_gap "$G"
   bspc config -d focused left_padding "$P" &
   bspc config -d focused right_padding "$P"
}

main(){
   while read -r _; do
      xprop="$(xprop -root _NET_CURRENT_DESKTOP)"
      case "${xprop##*= }" in
         9) P=0; G=0; exec_
            ;;
         *) logic; exec_
      esac
      #[ "$W" -lt "2" ] && sp="0.60" || sp="0.5"
      #bspc config split_ratio "$sp"
   done < "$GAPFIFO"
}

main
