#!/bin/sh

logic(){
   W=$(bspc query -N -n .local.tiled | wc -l)
   [ "$W" -lt 1 ] && W=1
   G=$((((GN-W)*GS)-G0))
   [ "$G" -le "$G0" ] && G="$G0"
   P=$(((PN-W)*PS*10)); [ "$P" -le 1 ] && P=0
}

exec_(){
   bspc config --desktop focused window_gap $G
   bspc config --desktop focused left_padding $P &
   bspc config --desktop focused right_padding $P
}

main(){
   $((GS+=G0))
   while read -r _; do
      xprop="$(xprop -root _NET_CURRENT_DESKTOP)"
      case "${xprop##*= }" in
         9) P=0; G=0; exec_
            ;;
         *) logic; exec_
      esac
   done < "$GAPFIFO"
}

main
